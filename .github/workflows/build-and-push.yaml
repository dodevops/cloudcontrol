name: "Build and push"

on:
    push:
        branches:
            - master
    release:
        types:
            - created

steps:
    - name: Checkout
      uses: actions/checkout@v1
    - name: Set tag to latest
      env:
          TAG: latest
      if: github.ref == "master"
    - name: Set tag to release
      env:
          TAG: ${{ github.ref }}
      if: github.ref != "master"
    - run: build.sh $TAG
    - name: Push AWS Image
      uses: julioarruda/pushimagetoregistry@v1
      with:
          acr-tokenname: ${{ secrets.DOCKER_USERNAME }}
          acr-token: ${{ secrets.DOCKER_TOKEN }}
          acr-account: registry.hub.docker.com
          acr-imagename: dodevops/cloudcontrol-aws
    - name: Push Azure Image
      uses: julioarruda/pushimagetoregistry@v1
      with:
          acr-tokenname: ${{ secrets.DOCKER_USERNAME }}
          acr-token: ${{ secrets.DOCKER_TOKEN }}
          acr-account: registry.hub.docker.com
          acr-imagename: dodevops/cloudcontrol-aws
